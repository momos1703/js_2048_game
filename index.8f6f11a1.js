var t={};class e{static Status={idle:"idle",playing:"playing",win:"win",lose:"lose"};initialState=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];constructor(){this.currentState=this.initialState.map(t=>[...t]),this.status=e.Status.idle,this.score=0}getScore(){return this.score}getState(){return this.currentState}getStatus(){return this.updateStatus(),this.status}start(){this.status=e.Status.playing,this.currentState=this.makeDeepCopyState(this.initialState),this.createRandomTile(),this.createRandomTile(),this.showTiles()}restart(){this.clearTheBoard(),this.showTiles(),this.status=e.Status.idle,this.score=0}moveUp(){if(this.status!==e.Status.playing)return;let t=!1;for(let e=0;e<4;e++){let r=this.currentState.map(t=>t[e]),{newLine:s,moved:a}=this.processColumn(r);a&&(t=!0);for(let t=0;t<4;t++)this.currentState[t][e]=s[t]}return t&&this.createRandomTile(),t}moveDown(){if(this.status!==e.Status.playing)return;let t=!1;for(let e=0;e<4;e++){let r=this.currentState.map(t=>t[e]).reverse(),{newLine:s,moved:a}=this.processColumn(r);a&&(t=!0);let i=s.reverse();for(let t=0;t<4;t++)this.currentState[t][e]=i[t]}return t&&this.createRandomTile(),t}moveLeft(){if(this.status!==e.Status.playing)return;let t=!1;for(let e=0;e<4;e++){let r=this.currentState[e],{newLine:s,moved:a}=this.processColumn(r);a&&(t=!0),this.currentState[e]=s}return t&&this.createRandomTile(),t}moveRight(){if(this.status!==e.Status.playing)return;let t=!1;for(let e=0;e<4;e++){let r=this.currentState[e].reverse(),{newLine:s,moved:a}=this.processColumn(r);a&&(t=!0);let i=s.reverse();this.currentState[e]=i}return t&&this.createRandomTile(),t}processColumn(t){let e=[0,0,0,0],r=!1,s=0,a=0;for(let i=0;i<t.length;i++)0!==t[i]&&(!r&&s>0&&e[s-1]===t[i]?(e[s-1]*=2,a+=e[s-1],r=!0):(e[s]=t[i],s++,r=!1));let i=!this.areLinesEqual(t,e);return this.score+=a,{newLine:e,moved:i}}getColumn(t){return this.currentState.map(e=>e[t])}setColumn(t,e){for(let r=0;r<4;r++)this.currentState[r][t]=e[r]}areLinesEqual(t,e){return t.every((t,r)=>t===e[r])}makeDeepCopyState(t){return t.map(t=>[...t])}createRandomTile(){let t=this.randomNumber();if(!t)return;let[e,r]=t;this.currentState[e][r]=this.generateTileValue(),this.showTiles()}randomNumber(){let t=this.getRequiredTiles(0);if(0===t.length)return null;let e=Math.floor(Math.random()*t.length);return t[e]}getRequiredTiles(t){let e=[];for(let r=0;r<this.currentState.length;r++)for(let s=0;s<this.currentState[r].length;s++)this.currentState[r][s]===t&&e.push([r,s]);return e}generateTileValue(){return Math.random()>.9?4:2}updateStatus(){this.didPlayerWin()?this.status=e.Status.win:this.didPlayerLose()&&(this.status=e.Status.lose)}didPlayerWin(){return this.getRequiredTiles(2048).length>0}didPlayerLose(){return!(this.getRequiredTiles(0).length>0)&&!!this.checkEqualNeighbors()}checkEqualNeighbors(){for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(e<3&&this.currentState[t][e]===this.currentState[t][e+1]||t<3&&this.currentState[t][e]===this.currentState[t+1][e])return!1;return!0}showTiles(){let t=document.getElementsByClassName("field-cell"),e=0;for(let r=0;r<4;r++)for(let s=0;s<4;s++){let a=this.currentState[r][s];0===a?(t[e].innerText="",t[e].className="field-cell"):(t[e].innerText=a,t[e].className=`field-cell field-cell--${a}`),e++}}clearTheBoard(){this.currentState=this.makeDeepCopyState(this.initialState)}}const r=new(t=e),s=document.querySelector(".start"),a=document.querySelector(".game-score"),i=document.querySelector(".message-start"),n=document.querySelector(".message-win"),l=document.querySelector(".message-lose");s.addEventListener("click",function(){s.classList.contains("start")?(s.className="button restart",s.textContent="Restart",i.classList.add("hidden"),r.start()):(s.className="button start",s.textContent="Start",i.classList.remove("hidden"),n.classList.add("hidden"),l.classList.add("hidden"),a.textContent="0",r.restart())}),document.addEventListener("keydown",function(e){var s,i;e.preventDefault();let u=!1;switch(e.key){case"ArrowUp":u=r.moveUp();break;case"ArrowDown":u=r.moveDown();break;case"ArrowRight":u=r.moveRight();break;case"ArrowLeft":u=r.moveLeft()}u&&(s=r.getScore(),a.textContent=s,(i=r.getStatus())===t.Status.win?n.classList.remove("hidden"):i===t.Status.lose&&l.classList.remove("hidden"))});
//# sourceMappingURL=index.8f6f11a1.js.map
